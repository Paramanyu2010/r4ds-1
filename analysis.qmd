---
title: "Analyzing the Billboard 100"
author: "Paramanyu Gupta"
format: html
execute: 
  echo: false
---

```{r}
#| message: false
library(tidyverse)
library(tutorial.helpers)
```

```{r}
# Select 3 songs and reshape data for plotting
songs_data <- billboard %>%
  slice(5, 8, 9) %>%
  select(artist, track, wk1:wk5) %>%
  pivot_longer(cols = wk1:wk5, 
               names_to = "week", 
               values_to = "rank") %>%
  mutate(week = as.numeric(gsub("wk", "", week)),
         song_label = paste(artist, "-", track))

# Create line graph with facets and assign to variable
line_graph <- ggplot(songs_data, aes(x = week, y = rank, color = song_label)) +
  geom_line(size = 1.2) +
  scale_y_reverse() +
  labs(title = "Billboard Rank Over First 5 Weeks",
       x = "Week",
       y = "Rank (Lower is Better)",
       color = "Song") +
  theme_minimal() +
  theme(legend.position = "bottom") +
  facet_wrap(~ song_label)

# Save the plot
ggsave("line_graph.png", plot = line_graph, width = 10, height = 6)
```

```{r}
# Select 3 songs and reshape the data
billboard_long <- billboard %>%
  slice(1, 3, 8) %>%  # Select rows 1, 3, and 8 (3 different songs)
  select(artist, track, starts_with("wk")) %>%
  pivot_longer(
    cols = starts_with("wk"),
    names_to = "week",
    values_to = "rank"
  ) %>%
  filter(!is.na(rank)) %>%
  mutate(song_label = paste(artist, "-", track))

# Create the boxplot
ggplot(billboard_long, aes(x = song_label, y = rank)) +
  geom_boxplot() +
  scale_y_reverse() +
  labs(
    title = "Distribution of Billboard Chart Ranks for 3 Songs",
    x = "Song",
    y = "Chart Position (lower is better)"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
# Select the first 3 songs
top_3_songs <- billboard %>%
  slice(1:3)

# Transform from wide to long format and count weeks in top 100
song_weeks <- top_3_songs %>%
  pivot_longer(
    cols = starts_with("wk"),
    names_to = "week",
    values_to = "rank"
  ) %>%
  filter(!is.na(rank)) %>%  # Keep only weeks where song was ranked
  group_by(artist, track) %>%
  summarise(weeks_in_top_100 = n(), .groups = "drop") %>%
  mutate(song_label = paste(artist, "-", track))

# Create the bar graph
ggplot(song_weeks, aes(x = song_label, y = weeks_in_top_100)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(
    title = "Weeks in Billboard Top 100",
    subtitle = "First 3 Songs in Dataset",
    x = "Song",
    y = "Number of Weeks"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
#| cache: true
billboard_clean <- billboard |>
  filter(wk1 < 101) |>
  arrange(wk1) |>
  mutate(improvement = wk1 - wk2, .after = wk2) |>
  select(artist:improvement) |>
  rename(week1 = wk1, week2 = wk2)
```

```{r}
ggplot(billboard_clean, aes(x = improvement)) +
  geom_histogram(binwidth = 5, fill = "steelblue", color = "white", alpha = 0.8) +
  labs(
    title = "Billboard Chart Performance: Week 1 to Week 2",
    subtitle = "Distribution of rank changes between the first two weeks on the chart",
    x = "Improvement (Positive = Moved Up in Rankings)",
    y = "Number of Songs",
    caption = "Source: Billboard Hot 100 (Year 2000)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 13, margin = margin(b = 5)),
    plot.subtitle = element_text(size = 10, color = "gray40", margin = margin(b = 10)),
    plot.caption = element_text(size = 9, color = "gray50", hjust = 0),
    axis.title = element_text(size = 10),
    axis.text = element_text(size = 9),
    plot.margin = margin(10, 10, 10, 10)
  )
```

```{r}
household |>
  pivot_longer(
    cols = -family,
    names_to = c(".value", "child"),
    names_sep = "_"
  )
```

```{r}
#| cache: true
billboard_longer <- billboard |>
  pivot_longer(
    cols = starts_with("wk"),
    names_to = "week",
    values_to = "rank",
    values_drop_na = TRUE
  ) |>
  mutate(week = parse_number(week))
```

```{r}
ggplot(billboard_longer, aes(x = week, y = rank, group = track)) +
  geom_line(alpha = 0.3, color = "steelblue") +
  scale_y_reverse() +
  labs(
    title = "Billboard Hot 100 Track Performance Over Time",
    subtitle = "Chart position trajectory for all tracks in the year 2000",
    x = "Weeks After Release",
    y = "Billboard Rank (Lower is Better)",
    caption = "Source: Billboard Hot 100 (Year 2000)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 11, color = "gray40"),
    plot.caption = element_text(size = 9, color = "gray50", hjust = 0),
    panel.grid.minor = element_blank()
  )
```
